#!/bin/sh

printf Configuring extension
export MAESTRO="/workspace/examples/common/tools"
export FSP="/workspace/examples/models"
export TOOLS="/workspace/examples/tools/drobotti_rmqfmu"
printf "\t Maestro path: $MAESTRO"
printf "\t FMU search path: $FSP"

printf "Generating Mabl specification"

java -jar $MAESTRO/maestro-2.3.0-jar-with-dependencies.jar import sg1 ./coe.json ./multimodel.json -fsp $FSP -output ./generate/

printf "Run publisher script in other terminal"

python $TOOLS/rmq-publisher.py 2>&1 | tee ./publisher-out.txt &

python $TOOLS/consume.py 2>&1 | tee ./consume.txt &

printf "Simulating specifications"

java -jar $MAESTRO/maestro-2.3.0-jar-with-dependencies.jar interpret ./generate/spec.mabl -output ./target 2>&1 | tee ./out.txt
